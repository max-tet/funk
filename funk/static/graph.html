<!doctype html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width">
	<title>Funk</title>
	<link rel="stylesheet" type="text/css" href="/static/css/jsPlumbToolkit-defaults.css">
	<link rel="stylesheet" type="text/css" href="/static/css/funk.css">
	<link rel="stylesheet" type="text/css" href="/static/css/bootstrap.css">
</head>
<body>

    <div class="permission-demo jtk-surface"
         id="funk-canvas"
         v-on:click="onCanvasClick($event)">
        <funk-node-properties-modal
                :node="nodeUnderModification"
                :is-open="(nodeUnderModification != '')"
                v-on:save="modifyNode"
                v-on:cancel="nodeUnderModification = ''"></funk-node-properties-modal>
        <funk-add-node ref="addNode"
                       :nodetypes="nodetypes"
                       v-on:add-node="addNode"></funk-add-node>
        <funk-save-button></funk-save-button>
        <funk-node
                v-for="node in nodes"
                :key="node.nodeid"
                v-bind:node="node"
                v-on:edit="editNode"
                v-on:shift-clicked="toggleNodeSelection"></funk-node>
        <div id="not-found" v-if="graphNotFound">
            <h1>Graph <i>{{funkInstance.graphname}}</i> does not exist</h1>
            <div class="coverup"></div>
        </div>
    </div>

    <script type="text/x-template" id="funk-node-template">
        <div class="funk-node"
                v-bind:id="node.nodeid"
                v-bind:style="style"
                v-on:mouseover="node.ephemeral.isHovered = true"
                v-on:mouseleave="node.ephemeral.isHovered = false"
                v-on:click.shift.stop="shiftClick">
            <strong>{{node.name}}</strong><br/>
            <small>{{type.name}}</small>
            <div class="funk-node-edit-button" v-if="node.ephemeral.isHovered" v-on:click.stop="edit">
                <span class="badge"><span class="glyphicon glyphicon-pencil"></span></span>
            </div>
            <funk-node-property
                    v-for="p in node.props"
                    :key="p.propid"
                    :prop="p"></funk-node-property>
            <table>
                <tr v-for="i in nrOfRows">
                    <td is="funk-node-connector"
                        side="left"
                        v-bind:connector="type.connector_l[i-1]"
                        v-bind:nodeid="node.nodeid"></td>
                    <td is="funk-node-connector"
                        side="right"
                        v-bind:connector="type.connector_r[i-1]"
                        v-bind:nodeid="node.nodeid"
                        class="funk-attr-r"></td>
                </tr>
            </table>
        </div>
    </script>

    <script type="text/x-template" id="funk-node-connector-template">
        <td :id="elId"><span>{{(connector != undefined) ? connector.name : ''}}</span></td>
    </script>

    <script type="text/x-template" id="funk-node-property-template">
        <div><span class="small">{{prop.name}} <strong>{{prop.value}}</strong></span></div>
    </script>

    <script type="text/x-template" id="funk-node-properties-modal-template">
        <div class="modal fade" id="node_properties_modal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Properties</h4>
                    </div>
                    <div class="modal-body">
                            <div class="input-group">
                                <div class="input-group-addon">Name</div>
                                <input type="text" class="form-control" placeholder="Name"
                                   v-model="node.name" v-bind:value="node.name">
                            </div>
                            <template v-for="prop in node.props">
                                <div v-if="prop.type == 'string'" class="input-group">
                                    <div class="input-group-addon">{{prop.name}}</div>
                                    <input type="text"
                                           class="form-control"
                                           v-model="prop.value"
                                           v-bind:value="prop.value">
                                </div>
                                <div v-if="prop.type == 'boolean'" class="input-group btn-group">
                                    <div class="input-group-addon">{{prop.name}}</div>
                                    <button class="btn" type="button"
                                            v-bind:class="{'btn-primary': prop.value, 'btn-default': !prop.value}"
                                            v-on:click="prop.value = true">
                                        True
                                    </button>
                                    <button class="btn" type="button"
                                            v-bind:class="{'btn-primary': !prop.value, 'btn-default': prop.value}"
                                            v-on:click="prop.value = false">
                                        False
                                    </button>
                                </div>
                                <div v-if="prop.type == 'integer'" class="input-group">
                                    <div class="input-group-addon">{{prop.name}}</div>
                                    <input type="number"
                                           class="form-control"
                                           v-model="prop.value"
                                           v-bind:value="prop.value">
                                </div>
                                <div v-if="prop.type == 'float'" class="input-group">
                                    <div class="input-group-addon">{{prop.name}}</div>
                                    <input type="number"
                                           step="0.01"
                                           class="form-control"
                                           v-model="prop.value"
                                           v-bind:value="prop.value">
                                </div>
                            </template>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn" v-on:click="cancel">Cancel</button>
                        <button type="button" class="btn btn-primary" v-on:click="save">Save</button>
                    </div>
                </div>
            </div>
        </div>
    </script>

    <script type="text/x-template" id="funk-save-button-template">
        <button id="funk-button-save" type="button" class="btn btn-default funk-control"
                v-on:click="save" v-bind:disabled="!active">
            {{text}}
        </button>
    </script>

    <script type="text/x-template" id="funk-add-node-template">
        <div id="funk-add-node">
            <div v-if="isActive">
                <input type="text"
                       class="form-control funk-control"
                       placeholder="Add Node"
                       v-model="filterText"
                       v-on:keydown.down="selectionDown"
                       v-on:keydown.up="selectionUp"
                       v-on:keydown.enter="addSelectedNode">
                <div class="nodetype-list">
                    <table>
                        <tr is="funk-nodetype-preview" v-on:add-node="addNode"
                            v-for="nodetype in filteredNodetypes"
                            :nodetype="nodetype"></tr>
                    </table>
                </div>
            </div>
            <button class="btn btn-primary funk-control"
                    type="button"
                    v-on:click="isActive=true" v-else>
                <span class="glyphicon glyphicon-plus"></span>
            </button>
        </div>
    </script>

    <script type="text/x-template" id="funk-nodetype-preview-template">
        <tr><td>
            <div class="funk-nodetype"
                 :class="{ 'funk-selected': nodetype.isSelected }"
                 :style="style"
                 v-on:click="addNode">
                <span>{{nodetype.name}}</span>
            </div>
        </td></tr>
    </script>

    <script type="text/javascript" src="/api/nodetypes"></script>
    <script type="text/javascript" src="/static/js/jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="/static/js/jquery.hotkeys.js"></script>
    <script type="text/javascript" src="/static/js/jquery.scrollintoview.js"></script>
    <script type="text/javascript" src="/static/js/vue.js"></script>
    <script type="text/javascript" src="/static/js/jsPlumb-2.1.7-min.js"></script>
    <script type="text/javascript" src="/static/js/bootstrap.js"></script>
    <script type="text/javascript" src="/static/js/funk.js"></script>
</body>